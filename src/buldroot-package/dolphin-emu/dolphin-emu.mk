################################################################################
#
# DOLPHIN EMU
#
################################################################################
# Version: Commits on Apr 3, 2021 - 5.0-13963
#DOLPHIN_EMU_VERSION = 7250d6e4e091f4b5b4f2289c2c732349b69a2e8a

# Version: Commits on Apr 14, 2021
DOLPHIN_EMU_VERSION = 14959a1087b05500c5704b59e7d694d941d4a5cf

DOLPHIN_EMU_SITE = $(call github,dolphin-emu,dolphin,$(DOLPHIN_EMU_VERSION))
DOLPHIN_EMU_LICENSE = GPLv2+
DOLPHIN_EMU_DEPENDENCIES = libevdev ffmpeg zlib libpng lzo libusb libcurl bluez5_utils hidapi xz host-xz

DOLPHIN_EMU_SUPPORTS_IN_SOURCE_BUILD = NO

DOLPHIN_EMU_CONF_OPTS  = -DTHREADS_PTHREAD_ARG=ON
DOLPHIN_EMU_CONF_OPTS += -DUSE_DISCORD_PRESENCE=OFF
DOLPHIN_EMU_CONF_OPTS += -DBUILD_SHARED_LIBS=OFF
DOLPHIN_EMU_CONF_OPTS += -DDISTRIBUTOR='Batocera.PLUS'
DOLPHIN_EMU_CONF_OPTS += -DENABLE_PULSEAUDIO=OFF
DOLPHIN_EMU_CONF_OPTS += -DUSE_SHARED_ENET=ON

ifeq ($(BR2_PACKAGE_BATOCERA_TARGET_X86_64),y)
DOLPHIN_EMU_DEPENDENCIES += xserver_xorg-server qt5base
DOLPHIN_EMU_CONF_OPTS += -DENABLE_NOGUI=OFF
DOLPHIN_EMU_CONF_OPTS += -DENABLE_EGL=OFF
endif

ifeq ($(BR2_PACKAGE_BATOCERA_TARGET_S922X),y)
DOLPHIN_EMU_DEPENDENCIES += libdrm
DOLPHIN_EMU_CONF_OPTS += -DENABLE_QT=OFF
DOLPHIN_EMU_CONF_OPTS += -DENABLE_EGL=ON
DOLPHIN_EMU_CONF_OPTS += -DENABLE_LTO=ON
endif

$(eval $(cmake-package))
