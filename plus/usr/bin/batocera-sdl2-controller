#!/bin/bash
##
## Batocera.PLUS
##
## Código escrito por: Sérgio de Carvalho Júnior
## Supervisão: Alexandre Freire dos Santos
################################################################################

JOY_ID=$(LC_ALL=C sdl2-jstest -l | grep -E '^Joystick GUID:[ ]*' | cut -d ':' -f 2 | xargs)

SDL_DB="$(cat /opt/Gamecontrollerdb/gamecontrollerdb.txt | grep -E ',platform:Linux,$')"

SDL_DB_FILTRED=$(
    for ID in ${JOY_ID}
    do
        echo "${SDL_DB}" | grep -E "${ID}"
    done
)

# Se algum controle estiver ligado ele será mapeado
if [ "${JOY_ID}" != '' ]; then
    export SDL_GAMECONTROLLERCONFIG=$( echo "${SDL_DB_FILTRED}" | uniq)
fi